//>>built
define("xstyle/core/Rule",["xstyle/core/expression","put-selector/put","xstyle/core/utils"],function(n,p,s){function k(){}function q(a){this.caller=a;this.args=[]}var r=Object.create||function(a){function b(){}b.prototype=a;return new b},t={"{":"}","[":"]","(":")"},u=p("div");k.prototype={eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",b[d])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},
newRule:function(a){a=(this.rules||(this.rules={}))[a]=new k;a.disabled=this.disabled;return a},newCall:function(a,b,c){return new q(a)},addSheetRule:function(a,b){if(b&&"@"!=a.charAt(0))try{var c=this.styleSheet,d=c.cssRules||c.rules,e=-1<this.ruleIndex?this.ruleIndex:d.length;c.addRule(a,b,e);return d[e]}catch(f){console.warn("Unable to add rule",f.message)}},onRule:function(){var a=this.getCssRule();if(this.installStyles)for(var b=0;b<this.installStyles.length;b++){var c=this.installStyles[b];
a.style[c[0]]=c[1]}},setStyle:function(a,b){this.cssRule?this.cssRule.style[a]=b:(this.installStyles||(this.installStyles=[])).push([a,b])},getCssRule:function(){this.cssRule||(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},declareProperty:function(a,b,c){if(!this.disabled)if(b.length)if("\x3e"==b[0].toString().charAt(0)){if(!a){this.generator=b;var d=this;require(["xstyle/core/generate","xstyle/core/elemental"],function(a,c){b=
a(b,d);c.addRenderer(d,b)})}}else{var e=a in u.style||this.getDefinition(a);if(!c||!e){c=this.definitions||(this.definitions={});var f=b[0];if(f.indexOf&&-1<f.indexOf(","))for(var f=b.join("").split(/\s*,\s*/),h=[],g=0;g<f.length;g++)h[g]=n(this,a,f[g]);c[a]=h||n(this,a,b);e&&console.warn('Overriding existing property "'+a+'"')}}else c=this.definitions||(this.definitions={}),c[a]=b},setValue:function(a,b,c){if(!this.disabled){var d=this.values||(this.values=[]);d.push(a);d[a]=b;var e=b.calls;if(e)for(d=
0;d<e.length;d++){var f=e[d],h=f.ref;h&&"function"==typeof h.call&&h.call(f,this,a,b)}if(a){var g=a;do{if(e=(c||this).getDefinition(a)){for(var v=this,e=e.splice?e:[e],d=0;d<e.length;d++){var l;s.when(e[d],function(a){l=a.put&&a.put(b,v,g)});if(l){l.then&&l.then(function(){});break}}break}a=a.substring(0,a.lastIndexOf("-"))}while(a)}}},put:function(a,b){this.extend(b);if("defaults"!=a&&a&&"string"==typeof a&&this.values)for(var c=a.toString().split(/,\s*/),d=0;d<c.length;d++){var e=this.values[d];
e&&b.setValue(e,c[d],this)}},extend:function(a,b){console.log("extending ",a);var c=this,d=c.cssText;if(a.cssRule)for(var d=c.cssRule.style,e=a.cssRule.style,f=a.inheritedStyles||(a.inheritedStyles={}),h=0;h<d.length;h++){var g=d[h];if(!e[g]||f[g])e[g]=d[g],f[g]=!0}else a.cssText+=d;"values,variables,calls".replace(/\w+/g,function(b){var d=c[b];d&&(a[b]=r(d))});if(b){if(d=c.definitions)a.definitions=r(d);a.tagName=c.tagName||a.tagName}a.base=c;c.eachProperty(function(b,c){a.setValue(b,c)});c.generator&&
a.declareProperty(null,c.generator)},getDefinition:function(a,b){var c=this;do var d=c.definitions&&c.definitions[a]||b&&c.rules&&c.rules[a],c=c.parent;while(!d&&c);return d},appendTo:function(a,b){return p(b||a,(b?"-":"")+(this.tagName||"span")+this.selector)},cssText:""};var m=q.prototype=new k;m.declareProperty=m.setValue=function(a,b){this.args.push(b)};m.toString=function(){var a=this.operator;return a+this.args+t[a]};return k});
//@ sourceMappingURL=Rule.js.map