//>>built
define("dgrid/tree","dojo/_base/declare,dojo/_base/array,dojo/_base/Deferred,dojo/has,dojo/query,dojo/on,dojo/aspect,./Grid,dojo/has!touch?./util/touch,put-selector/put".split(","),function(y,s,t,u,q,v,j,w,n,k){return function(c){var x=c.renderCell||w.defaultRenderCell,r,e;c||(c={});c.shouldExpand=c.shouldExpand||function(b,c,d){return d};j.after(c,"init",function(){var b=c.grid,l=".dgrid-content .dgrid-column-"+c.id,d,g=[];if(!b.store)throw Error("dgrid tree column plugin requires a store to operate.");
if(!c.renderExpando)c.renderExpando=function(a,b,c){var h=this.grid.isRTL?"right":"left",d=".dgrid-expando-icon";b&&(d+=".ui-icon.ui-icon-triangle-1-"+(c?"se":"e"));a=k("div"+d+"[style=margin-"+h+": "+a*(this.indentWidth||9)+"px; float: "+h+"]");a.innerHTML="&nbsp;";return a};g.push(b.on(c.expandOn||".dgrid-expando-icon:click,"+l+":dblclick,"+l+":keydown",function(a){var f=b.row(a);(!b.store.mayHaveChildren||b.store.mayHaveChildren(f.data))&&("keydown"!=a.type||32==a.keyCode)&&!("dblclick"==a.type&&
e&&1<e.count&&f.id==e.id&&-1<a.target.className.indexOf("dgrid-expando-icon"))&&b.expand(f);-1<a.target.className.indexOf("dgrid-expando-icon")&&(e&&e.id==b.row(a).id?e.count++:e={id:b.row(a).id,count:1})}));u("touch")&&g.push(b.on(n.selector(l,n.dbltap),function(){b.expand(this)}));if(!b._expanded)b._expanded={};g.push(j.after(b,"insertRow",function(a){var b=this.row(a);c.shouldExpand(b,r,this._expanded[b.id])&&this.expand(a,!0,!0);return a}));g.push(j.before(b,"removeRow",function(a,c){var d=a.connected;
d&&(q(">.dgrid-row",d).forEach(function(a){b.removeRow(a,!0)}),c||k(d,"!"))}));c.collapseOnRefresh&&g.push(j.after(b,"cleanup",function(){this._expanded={}}));b._calcRowHeight=function(a){var b=a.connected;return a.offsetHeight+(b?b.offsetHeight:0)};b.expand=function(a,f,g){var h=a.element?a:b.row(a),a=h.element;if((a=-1<a.className.indexOf("dgrid-expando-icon")?a:q(".dgrid-expando-icon",a)[0])&&a.mayHaveChildren){var e=void 0===f?!this._expanded[h.id]:f;a.className="dgrid-expando-icon ui-icon ui-icon-triangle-1-"+
(e?"se":"e");var j=a.preloadNode,f=h.element,i,l;if(!j){i=f.connected=k("div.dgrid-tree-container");var j=a.preloadNode=k(f,"+",i,"div.dgrid-preload"),o=function(a){return b.store.getChildren(h.data,a)};o.level=a.level;c.allowDuplicates&&(l={parentId:h.id});t.when(b.renderQuery?b._trackError(function(){return b.renderQuery(o,j,l)}):b.renderArray(o(l),j,{query:o}),function(){if(b._expanded[h.id]){var a=i.scrollHeight;i.style.height=a?a+"px":"auto"}});var n=function(a){var b=this.style.height;if(b)this.style.display=
"0px"==b?"none":"block";a?(k(this,".dgrid-tree-resetting"),setTimeout(function(){k(i,"!dgrid-tree-resetting")}),d=!0):d||(d=!1);this.style.height=""};v(i,"transitionend,webkitTransitionEnd,oTransitionEnd,MSTransitionEnd",n);d||setTimeout(function(){n.call(i)},600)}i=f.connected;i.hidden=!e;var m=i.style,p;!1===d||g?(m.display=e?"block":"none",m.height=""):(e?(m.display="block",p=i.scrollHeight,m.height="0px"):(k(i,".dgrid-tree-resetting"),m.height=i.scrollHeight+"px"),setTimeout(function(){k(i,"!dgrid-tree-resetting");
m.height=e?p?p+"px":"auto":"0px"}));e?this._expanded[h.id]=!0:delete this._expanded[h.id]}};j.after(c,"destroy",function(){s.forEach(g,function(a){a.remove()});delete b.expand;delete b._calcRowHeight})});c.renderCell=function(b,e,d,g){var a=c.grid,f=Number(g&&g.query&&g.query.level)+1,j=!a.store.mayHaveChildren||a.store.mayHaveChildren(b),h=g.parentId,f=r=isNaN(f)?0:f,a=c.renderExpando(f,j,a._expanded[(h?h+"-":"")+a.store.getIdentity(b)]);a.level=f;a.mayHaveChildren=j;(b=x.call(c,b,e,d,g))&&b.nodeType?
(k(d,a),k(d,b)):d.insertBefore(a,d.firstChild)};return c}});